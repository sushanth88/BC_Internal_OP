{% extends 'layout.html' %}
{% block content %}
  <h2>Expenses â€” Restaurant</h2>
  <p>Track restaurant expenses. Import from Excel/CSV or add manually below.</p>

  <div class="grid" style="display:grid; grid-template-columns: 1fr; gap: 16px; align-items:start;">
    <section style="border:1px solid var(--muted-border,#e5e7eb); padding:12px; border-radius:8px;">
      <h3 style="margin-top:0;">Import from File</h3>
      <form method="post" action="{{ url_for('expenses_restaurant_upload') }}" enctype="multipart/form-data">
        {{ upload_form.hidden_tag() }}
        <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
          {{ upload_form.file(label_class='') }}
          <label>{{ upload_form.overwrite() }} Overwrite matching Invoice #</label>
          {{ upload_form.submit(class_='btn') }}
          <a href="{{ url_for('expenses_restaurant_template') }}" class="btn" style="margin-left:auto;">Download CSV Template</a>
        </div>
      </form>
      <small>Accepted columns (case-insensitive): date, category, vendor, description, amount, payment_method, invoice_number, notes.</small>
    </section>

    <section style="border:1px solid var(--muted-border,#e5e7eb); padding:12px; border-radius:8px;">
      <h3 style="margin-top:0;">Add Expense</h3>
      <form method="post" action="{{ url_for('expenses_restaurant') }}">
        {{ form.hidden_tag() }}
        <input type="hidden" name="form-id" value="manual" />
        <div style="display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px;">
          <div>{{ form.date.label }} {{ form.date() }}</div>
          <div>{{ form.category.label }} {{ form.category() }}</div>
          <div>{{ form.vendor.label }} {{ form.vendor() }}</div>
          <div>{{ form.amount.label }} {{ form.amount(step='0.01') }}</div>
          <div class="col-span-2" style="grid-column: span 2;">{{ form.description.label }} {{ form.description(rows=2) }}</div>
          <div>{{ form.payment_method.label }} {{ form.payment_method() }}</div>
          <div>{{ form.invoice_number.label }} {{ form.invoice_number() }}</div>
          <div class="col-span-4" style="grid-column: 1 / -1;">{{ form.notes.label }} {{ form.notes(rows=2) }}</div>
        </div>
        <div style="margin-top:10px;">{{ form.submit(class_='btn') }}</div>
      </form>
    </section>

    <section style="border:1px solid var(--muted-border,#e5e7eb); padding:12px; border-radius:8px;">
      <h3 style="margin-top:0;">Expenses</h3>
      <form method="get" action="{{ url_for('expenses_restaurant') }}" style="display:flex; gap:10px; flex-wrap:wrap; align-items:end;">
        <div>
          <label for="start">Start</label>
          <input type="date" id="start" name="start" value="{{ start }}" />
        </div>
        <div>
          <label for="end">End</label>
          <input type="date" id="end" name="end" value="{{ end }}" />
        </div>
        <div>
          <label for="category">Category</label>
          <input type="text" id="category" name="category" value="{{ category }}" placeholder="e.g., Supplies" />
        </div>
        <div>
          <button class="btn" type="submit">Filter</button>
        </div>
        <div style="margin-left:auto; font-weight:600;">Total: {{ '%.2f'|format(total_amount or 0.0) }}</div>
      </form>

      <div style="overflow:auto; margin-top:10px;">
        <table class="table" style="min-width:900px;">
          <thead>
            <tr>
              <th>Date</th>
              <th>Category</th>
              <th>Vendor</th>
              <th>Description</th>
              <th style="text-align:right;">Amount</th>
              <th>Payment</th>
              <th>Invoice #</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            {% for e in expenses %}
              <tr>
                <td>{{ e.date.strftime('%Y-%m-%d') }}</td>
                <td>{{ e.category }}</td>
                <td>{{ e.vendor }}</td>
                <td>{{ e.description }}</td>
                <td style="text-align:right;">{{ '%.2f'|format(e.amount or 0.0) }}</td>
                <td>{{ e.payment_method }}</td>
                <td>{{ e.invoice_number }}</td>
                <td>{{ e.notes }}</td>
              </tr>
            {% else %}
              <tr><td colspan="8" style="text-align:center; color:var(--muted-text,#6b7280);">No expenses yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  </div>
{% endblock %}
